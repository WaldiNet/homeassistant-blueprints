blueprint:
  name: Betreten einer Zone
  description: Sende eine Benachrichtigung an ein Ger채t, wenn eine Person eine bestimmte Zone betritt.
  domain: automation
  source_url: https://github.com/WaldiNet/homeassistant-blueprints/blob/main/automations/notify_entering_zone_de.yaml
  author: Eric Falsett
  input:
    person_entity:
      name: Person
      selector:
        entity:
          filter:
            domain: person
    zone_entity:
      name: Zone
      selector:
        entity:
          filter:
            domain: zone
    notify_device:
      name: Ger채t zur Benachrichtigung
      description: Ger채t muss die offizielle Home Assistant App ausf체hren, um Benachrichtigungen zu empfangen.
      selector:
        device:
          filter:
            integration: mobile_app

triggers:
  trigger: state
  entity_id: !input person_entity

variables:
  zone_entity: !input zone_entity
  # This is the state of the person when it's in this zone.
  zone_state: "{{ states[zone_entity].name }}"
  person_entity: !input person_entity
  person_name: "{{ states[person_entity].name }}"

conditions:
  condition: template
  # The first case handles entering the Home zone (special state 'home').
  # The second case handles entering all other zones.
  value_template: "{{ (zone_entity == 'zone.home' and trigger.from_state.state != 'home' and trigger.to_state.state == 'home') or (trigger.from_state.state != zone_state and trigger.to_state.state == zone_state) }}"

actions:
  - alias: "Benachrichtigen, dass eine Person die Zone betreten hat"
    domain: mobile_app
    type: notify
    device_id: !input notify_device
    message: '{{ person_name }} ist in "{{ zone_state }}" angekommen.'
    title: Tracking
